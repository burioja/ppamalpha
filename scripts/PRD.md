0. 메인 화면
0.1 탑바

검색어 입력창 (텍스트 입력창)

MeiliSearch 연동

표시되는 화면(바텀네비게이션 지도, 인박스 선택)에 따라 분기하여 검색 //문구수정//

파이어스토어 연동

현재 위치 표시

GPS 기반 현재 위치 표시

기지국 기반 위치 검증 기능

WiFi 기반 위치 검증 기능 (사용자 등록 필요)

현금 보유 표시 및 아이콘(클릭시 예산 화면으로 이동) //화면이동 추가//

개인 설정 아이콘(클릭시 설정 화면으로 이동 //화면이동 추가//

🔎 세부 요구사항(탑바)

UI/UX

검색창 placeholder: 무엇을 찾을까요? (#쿠폰, @가게, 텍스트)

검색 아이콘(좌측), clear 버튼(텍스트 입력 시 우측 X), 키보드 엔터 시 검색 실행.

현재 위치: 아이콘 + 읍/면/동 단위 주소 축약 표기(예: "강남구 역삼동"). 터치 시 지도 화면의 goToCurrentLocation() 트리거.

현금 보유: ₩1,234 포맷. 터치 시 BudgetScreen(예산 화면) 이동.

설정 아이콘: 터치 시 SettingsScreen 이동.

검색 분기 로직

바텀 탭이 지도일 때 → MeiliSearch(인덱스: posts_index, stores_index) + Firestore 보강 조회(권한/타겟팅/거리 조건).

바텀 탭이 인박스일 때 → MeiliSearch(posts_index) + Firestore(소유권/수신상태/소멸기한) 조인.

데이터/인덱스

Firestore: search_histories/{uid}/items(q, type, ts)

MeiliSearch 스키마(요약):

posts_index: { id, ownerId, type: 'general'|'coupon', title, text, tags[], createdAt, expireAt, geo:{lat,lng}, target:{gender,ageRange,areas[]}, deliverable:true, transferable, replyable, storeId }

stores_index: { id, name, desc, address, geo:{lat,lng}, verified }

권한/검증

위치 권한 거부 시: 탑바 위치표시 비활성 상태 + 설정 유도 스낵바.

오류 처리

네트워크 장애: 검색 실패. 연결을 확인해 주세요. 토스트.

MeiliSearch 타임아웃: Firestore fallback(제한 결과) + 일부 결과만 표시됩니다. 배지.

성능

입력 디바운스 250ms, 자동완성 10개 한정.

최근 검색어 최대 20개 캐시(Local + Firestore 동기화).

로그/분석

이벤트: search_submit, search_auto_suggest_click, tap_wallet, tap_settings.

0.2 바텀 네비게이션
0.3 바텀 네비게이션에서 선택한 화면 중앙에 표시 (지도, 인박스)
🔎 세부 요구사항(바텀탭)

탭 구성(제안): 지도(Map) / 인박스(Inbox) / 스토어(Store) / 커뮤니티(선택) / 지갑(Wallet)

상태 고정: 상단 StatusBar(사용자 컨테이너)는 탭 전환 시 고정 유지.

컨텍스트 버튼: 지도 탭 활성화 시 바텀의 특정 버튼을 내 위치 트리거로 전환(기존 요구사항 연계). 커뮤니티 탭일 때 글쓰기로 전환(선택 사항, 기존 대화 맥락).

라우팅: /main?tab=map|inbox|store|wallet 쿼리 파라미터 유지.

1. 지도 화면

Google 지도 API 불러오기
Map style: 지형, 도로, 건물 외 아무것도 표시되지 않음
Fog of war 표시 (최근 30일간 갔던 장소는 밝게 표시)

마커 아이콘 표시

지도 줌에 따라 마커 클러스터링하여 숫자로 표시

자기가 받을 수 있는 포스트만 표시 //추가//

일정 거리 이내 마커(30m)는 합쳐서 숫자로 표시 //50m -> 30m 로 변경//

사용자 화면에 따라 일정 거리(3km) 이내 마커 표시

롱프레스 (롱프레스한 위치 1.1로 전달) >> 1.1. 포스트 배포화면 이동

기타 기능은 일반 구글지도와 같음
위치 기반(GPS, 기지국, WIFI 등)으로 30 m 이내에 있는 포스트 받기 // 추가//

필터링 창 (일반, 쿠폰) //워크, 라이프 -> 일반, 쿠폰 변경//

🔎 세부 요구사항(지도)

UI/UX

스타일 JSON(건물/도로/지형 외 비표시) 적용. 야간/주간 모드 자동 전환(선택).

Fog of War: visits/{uid}/points(최근 30일) 히트맵 밝기 상향.

필터 시트: 토글(일반/쿠폰), 거리 슬라이더(기본 3km), 정렬(가까운순/최신순).

데이터 소스

Firestore map_markers + 조인 posts(타겟팅/소멸/전달 가능 등 조건 적용).

비즈니스 규칙

30m 병합: 동일 타입/동일 소유자 우선 병합, 대표 마커에 카운트 배지.

표시 범위: 지도 중심 geo-hash 기반 타일 조회(3km), 스크롤 시 증분 fetch.

"자기가 받을 수 있는 포스트" 판정:

사용자 프로필(target 매칭), 위치 범위 충족, 미소멸, 미사용, 차단 목록 제외.

동작/플로우

롱프레스 → 좌표 전달 → 1.1 팝업.

포스트 받기: 현재 위치 인증(정밀: GPS, 보조: Cell/WiFi), 30m 이내일 때만 claim 활성.

오류/예외

위치 스푸핑 감지(속도/드리프트/루트 불연속성) 시 수령/배포 차단 + 경고.

성능

마커 가상화(클러스터링 라이브러리), 한 뷰포트 500개 제한, 60fps 목표.

로그

map_view, marker_cluster_expand, filter_apply, post_claim_attempt.

1.1 포스트 배포화면 (팝업)

이 위치에 뿌리기 (1.2. 이동)

이 주소에 뿌리기 (1.3. 이동)

특정 업종에 뿌리기 (1.4. 이동)

취소

🔎 세부 요구사항(1.1)

UI: 하단 모달, 세 줄 설명(수수료/반경/타겟팅 주의), 아이콘 버튼 3종.

권한: 배포는 로그인/계정/지갑 생성 완료 사용자만 가능.

로그: deploy_menu_open, deploy_route_select.

1.2 포스트 설정화면 (위치)

지도 화면에서 롱프레스 한 포인트(GPS기반) 지도 표시 //GPS 기반 추가//

포스트 선택(타일)창

저장된 포스트 불러오기

저장된 포스트 없는 경우에는 포스트 만들기로 이동 텍스트 및 터치 시 포스터 만들기 이동

배포 수량 입력창 (숫자 입력창, 필수 입력)

배포 가격 입력창 (숫자 입력창, 필수 입력)

토탈 가격 표시 (배포량 × 가격) 텍스트

배포 버튼 (/asset/ppam_work 아이콘으로 마커 표시)

🔎 세부 요구사항(1.2)

검증: 좌표 고정 후 ±10m 편집 허용, 반경 기본 100m(선택값).

포스트 선택: user_posts 최근 20개, 썸네일+타입+소멸일 표시. 없음→만들기 CTA.

입력: 수량(1~9,999), 개당가격(최소 ₩1). 실시간 총액 계산.

결제/정산: 총액 + 수수료(예: 3% + 최소 ₩X) 미리보기. 배포 누르면 예치(escrow) 홀드.

쓰기: map_markers 생성, posts/{id} 참조, 상태 active.

오류: 지갑 잔액 부족 → BudgetScreen 이동 유도.

1.3 포스트 설정화면 (주소)

지도 화면에서 롱프레스 한 포인트의(주소명) 반환 및 지도 표시 //문구수정//

포스트 선택(타일)창

저장된 포스트 불러오기

저장된 포스트 없는 경우에는 포스트 만들기로 이동 텍스트 및 터치 시 포스터 만들기 이동

배포 수량 입력창 (숫자 입력창, 필수 입력)

배포 가격 입력창 (숫자 입력창, 필수 입력)

토탈 가격 표시 (배포량 × 가격) 텍스트

배포 버튼 (ppam_work 아이콘으로 마커 표시)

🔎 세부 요구사항(1.3)

주소 변환: Reverse Geocoding, 행정동/도로명 동시 표기, 주소 수정 가능.

나머지 검증/결제/쓰기 로직은 1.2와 동일.

1.4 포스트 설정화면 (업종)

지도 화면에서 롱프레스 한 위치(GPS기반) 표시 및 3km 반경 표시 //GPS기반 추가//

업종 선택화면 (드롭다운 박스, 요식업, 배움)

지도 반경과 업종에 따라 선택 업종 개수 표시

포스트 선택(타일)창

저장된 포스트 불러오기

저장된 포스트 없는 경우에는 포스트 만들기로 이동 텍스트 및 터치 시 포스터 만들기 이동

배포 수량 입력창 (숫자 입력창, 필수 입력)

배포 가격 입력창 (숫자 입력창, 필수 입력)

토탈 가격 표시 (배포량 × 가격) 텍스트

배포 버튼 (ppam_work 아이콘으로 마커 표시)

🔎 세부 요구사항(1.4)

업종 분류: stores.category in ['요식업','배움', ...] 확장 가능.

대상 집합 계산: 3km 내 해당 업종 수 카운트(실시간), 혼잡 경고(>N개) 표기.

배포 단위: 업종 대상 수와 배포 수량의 관계(랜덤/균등/우선순위) 선택 옵션(확장).

결제/쓰기: 1.2 동일. targetAudience = 업종조건 저장.

2. 인박스 화면

내 (만든)포스트, 받은 포스트 탭 메뉴

리스트 표시 (썸네일, 발행자, 포스트타입, 내용)

필터링 (소멸시기순, 받은날짜순)

플로팅 버튼 (2.1로 이동) //바텀 네비게이션 버튼 변경? 고민//

🔎 세부 요구사항(인박스)

UI/UX: 탭 고정, 각 탭 무한 스크롤, 스켈레톤 로딩.

정렬/필터: 소멸 임박 배지, 새 포스트 점 표시.

데이터: user_posts(내가 만든), received_posts(내가 받은) 서브컬렉션.

플로팅 버튼: + 만들기 → 2.1 이동. 지도 탭과의 컨텍스트 버튼 충돌 주의.

2.1 내 포스트 만들기

그림파일 업로드 버튼

텍스트 입력

사운드

링크 추가 //추가//

포스트 타입 선택 화면 (일반, 쿠폰)

포스트 소멸시효 선택 (~30일) 체크박스

포스트 사용 시 선택 (발행자에게 송금) 체크박스

포스트 전달기능 체크박스

응답기능 체크박스

타겟팅 성별, 나이 등등

게시물 클릭 시 수정하기

텍스트와 그림파일이 합쳐진 하나의 이미지 파일 생성 //추가//

포스트마다 만들어진 날짜, 조건 등에 따라 아이디 생성 //추가//

🔎 세부 요구사항(2.1)

에셋 처리: 이미지 리사이즈(최대 2048px), WebP 우선 저장, 사운드 m4a.

문구/링크 검사: 금칙어/금지 URL 필터, 미성년자 보호 정책 적용.

타겟팅: gender(any/m/f), ageRange([min,max]), areas(행정코드 배열) 다중 선택.

쿠폰: uses: 1..N, redeemWithin: date, redeemAt: geo(optional).

ID 생성: post_{yyyyMMddHHmm}_{rand} + 해시, 조건 요약 필드 condSig 저장.

합성 이미지: 텍스트+이미지 캔버스 합성(서버 함수 또는 클라이언트) → 공유/미리보기 동일성 유지.

오류/검증:

누락 필드 경고 토스트, 용량 초과(>10MB) 업로드 차단, 저작권 경고.

저장: 초안(draft)/게시(published) 상태 구분.

2.2 받은 포스트 게시물 클릭 시

해당 포스트 표시

쿠폰인 경우 사용하기 버튼

GPS 기반

전달가능한 경우 전달하기 버튼

응답가능한 경우 대화창 입력창 및 대화표시

스토어로 이동 버튼

🔎 세부 요구사항(2.2)

쿠폰 사용: 현재 위치 인증(반경 30m), 사용 시 escrow transfer 트리거(발행자/가맹점에 송금 규칙).

전달: maxForwardDepth(기본 1) 초과 시 차단, 전달 경로 로그.

응답: 메시지 쓰레드 생성 message_threads/{postId}-{uid}.

스토어 이동: 연결된 storeId가 있는 경우에만 버튼 활성화.

2.3 내 스토어 수정하기

인증받기

가게명

사진

리뷰

🔎 세부 요구사항(2.3)

인증: 사업자등록증/전화 인증, 옵션: NFC/WiFi 현장 검증(스토어 화면 항목과 연계).

사진: 최대 10장, 대표 이미지 지정.

리뷰: 신고/블록, 별점 평균 계산, 악성 리뷰 필터.

3. 스토어 화면

인증 업체 표시 유무

가게명

가게 사진

직원 인증

가게 설명

주소 (구글지도 파싱)

NFC 기능을 통한 직원 인증

WiFi를 통한 직원 인증 등

🔎 세부 요구사항(스토어)

UI: 상단 커버, 인증 뱃지, 지도 미니맵, 길찾기(깃발) 버튼.

직원 인증:

NFC: 지정 태그 UID 매칭 → 직원 등록 기기에서만 성공.

WiFi: 등록 SSID/BSSID 근접성 검증 + 시간대 규칙.

데이터: stores, store_staff, store_verifications.

로그: store_view, staff_verify_success/fail.

4. 로그인 화면

PPAM 로고 (이미지)

로그인 버튼 (버튼)

회원가입 버튼 (버튼)

비밀번호 찾기 (텍스트 버튼)

아이디 입력창 (텍스트 입력창)

비밀번호 입력창 (텍스트 입력창)

🔎 세부 요구사항(로그인)

Auth: Firebase Email/Password, 향후 OAuth(Apple/Google) 확장 포인트.

보안: reCAPTCHA v3(봇 방지), 5회 실패 시 일시 잠금.

UX: 저장된 이메일 자동완성, 로그인 유지 체크.

5. 회원가입 화면
5.1 회원가입화면 - 개인정보입력 (1)

회원가입 진행창, 1, 2, 3단계 표시

이메일(아이디) 입력창 (텍스트 입력창)

이메일 중복여부 확인 기능

이메일 인증 버튼 (버튼)

이메일로 인증번호 발송 기능

이메일 인증번호 입력창

이메일 인증번호 일치 여부 확인

이메일 인증여부 결과 텍스트

비밀번호 입력창 (텍스트 입력창)

비밀번호 확인창 (텍스트 입력창)

비밀번호 일치 여부 확인

비밀번호 일치여부 결과 텍스트

국가번호 선택창 (드롭다운 박스)

모바일 입력창 (텍스트 숫자 입력창)

모바일 인증 버튼 (버튼)

모바일로 인증번호 발송 기능

모바일 인증번호 입력창

모바일 인증번호 일치 여부 확인

모바일 인증여부 결과 텍스트

생년월일 입력 드롭다운 박스 3개 (연도, 월, 일)

성별 선택 슬라이더 (좌 남, 우 여)

주소 입력 (어드레스 픽커?) → 주소 입력창

GPS로 주소 입력 검증

다음 버튼 (버튼) → 5.2화면 이동

빈칸 있으면 채워달라고 토스트 메시지 띄우고 다음화면으로 넘어가지 않음

인증 안받은거 있으면 받으라고 토스트 메시지 띄우고 다음화면으로 넘어가지 않음

파이어베이스에 해당 정보 등록

🔎 세부 요구사항(5.1)

검증: 비밀번호 정책(최소 8자, 대/소문자+숫자 포함), 휴대폰 국가코드.

안전성: 이메일/휴대폰 인증 OTP 만료 3분, 재발송 쿨다운 30초.

데이터: users/{uid} 기본 프로필 생성, verifications/{uid} 상태 기록.

5.2 회원가입화면 - 추가정보입력 (2)

이미지 등록 버튼 (이미지 버튼)

사진선택 창 뜨기

닉네임 입력창 (텍스트 입력창)

닉네임 중복여부 메시지

근무지 추가 버튼 (버튼)

주소 입력 (어드레스 픽커?) → 주소 입력창

닉네임 중복되면 다음화면으로 넘어가지 않음

파이어베이스에 해당 정보 등록

선정적인 자료 받기 유무 슬라이더 (좌 안받기, 우 받기)

폭력적인 자료 받기 유무 슬라이더 (좌 안받기, 우 받기)

혐오 자료 받기 유무 슬라이더 (좌 안받기, 우 받기)

🔎 세부 요구사항(5.2)

프로필 이미지: 얼굴 미노출 옵션 표기, 콘텐츠 가이드 링크.

닉네임: 2~15자, 이모지/특수문자 제한, 고유 인덱스 저장.

근무지: 다중 입력, 기본/보조 태그, 근무지 기반 타겟팅 허용 동의.

5.3 회원가입화면 (3)

서비스 약관 동의 텍스트

원문보기 버튼

토글 버튼

개인정보 수집 및 이용동의 텍스트

원문보기 버튼

토글 버튼

위치정보 수집 및 서비스 이용동의 텍스트

원문보기 버튼

토글 버튼

제3자 정보제공 이용동의 텍스트

원문보기 버튼

토글 버튼

가입 및 계좌만들기 완료 버튼 (버튼) → 5.4. 이동

Tajapay 계좌만들기 화면 이동

동의되어 있는거 없으면 가입 완료 되지 않음

파이어베이스에 해당 정보 등록

🔎 세부 요구사항(5.3)

토글: 모두 동의/개별 동의, 스크롤 끝까지 확인 후 활성화 옵션.

로그: 약관 세부 열람 이벤트 기록.

5.4 Tajapay 화면

계좌를 만들고 있습니다 로딩 메시지

로딩창

다 만들어지면 계좌가 만들어졌습니다.

개인 계좌 전화 표시

(Tajapay 절차가 있으면 절차대로 진행)

홈으로 이동 버튼 (버튼) 1.지도 화면 이동

🔎 세부 요구사항(5.4)

플로우: 계좌 생성 API 연동 → 성공 시 계좌ID/마스킹번호 표시 → 실패 시 재시도/문의.

보안: KYC/AML 체크(외부 SDK/웹뷰), 실패 사유 코드 저장.

부록
A. 주소 입력창

기능: GPS 자동 채움 + 수동 검색, 후보 리스트, 즐겨찾는 주소 저장.

검증: 좌표-주소 불일치 시 경고, 해외 주소 입력 제한 옵션.

B. 가게 인증창

와이파이: SSID/BSSID 등록, 지정 시간대 접속 기록, 관리용 토큰.

📌 추가 확장 사양(원문 유지 + 상세 반영)
A. 화면-연결 구조(Information Architecture & Routes)

MainScreen(/main)

TopBar(검색/위치/지갑/설정), BottomNav(지도/인박스/스토어/지갑)

Child: MapScreen(/map), InboxScreen(/inbox), StoreScreen(/stores), WalletScreen(/wallet), SettingsScreen(/settings)

BudgetScreen(/budget) ← TopBar 지갑 아이콘 터치

PostDeployModal(modal:/deploy) → 1.1

PostSetupLocation(/post/setup/location) → 1.2

PostSetupAddress(/post/setup/address) → 1.3

PostSetupCategory(/post/setup/category) → 1.4

PostCreate(/post/create) → 2.1

PostDetail(/post/:id) → 2.2

StoreEdit(/store/edit) → 2.3

StoreDetail(/store/:id) → 3

Auth: Login(/login), Signup step1~4(/signup/1..4)

주: 그림파일에 없는 예산(Budget) 화면은 원문 요구사항(탑바의 지갑 아이콘 동작)과 실제 기능 흐름에 반드시 필요하므로 **신규 정의(그림 비포함)**로 명시합니다.

B. 예산(Budget) 화면 — 신규 정의(그림 비포함)

목적: 배포/사용/전달/쿠폰사용 시 필요한 예치금/정산/수수료 확인·충전·출금·내역 조회.

UI

상단: 가용 잔액, 보류(에스크로) 금액, 누적 사용/수령

CTA: 충전, 출금, 내역, 카드/계좌 연동

최근 트랜잭션 리스트(아이콘: 배포/수령/환불/수수료)

기능

충전: PG/계좌이체/타자페이 연동

출금: 본인 계좌 인증 후 T+1 정산(정책)

내역: wallet_transactions 페이지네이션, CSV 내보내기(선택)

정책: 최소 잔액, 수수료 테이블 노출

데이터

wallets/{uid}: balance, escrow, updatedAt

wallet_transactions/{uid}/items: {type, amount, fee, postId, storeId, ts, status}

오류/검증

KYC 미완료/한도 초과 경고, 실패코드 노출, 재시도 링크.

C. 데이터 모델(Firestore) — 핵심 컬렉션

users/{uid}: profile, gender, birthYmd, address, prefs, verifications

user_posts/{uid}/{postId}: 원본/초안, 에셋 링크, condSig

posts/{postId}: 공개 메타(타입, 소멸, 타겟, storeId, transferable, replyable)

map_markers/{markerId}: geo, postId, radius, clusterSig, active

stores/{storeId}: name, desc, address, geo, verified, category

store_staff/{id}: storeId, userId, role, verifiedBy(NFC|WiFi)

received_posts/{uid}/{postId}: status(unread|read|used), receivedAt, hops

message_threads/{threadId} + messages

wallets/{uid} + wallet_transactions

verifications/{uid}: email/sms/wifi/location 상태

필수 색인 예시: (collection, fields)

posts: type+expireAt, geo+active, target.gender+target.ageRange

map_markers: geo+active, postId

received_posts: uid+status, receivedAt desc

D. Cloud Functions(예시)

createPost(): 업로드/검증/합성/색인 처리

deployPost(): 결제홀드→마커 생성→푸시 알림 범위 계산

claimPost(): 위치검증→소유 이전→쿠폰 사용 플래그

redeemCoupon(): 스토어 점검→정산 트리거(지갑/수수료 반영)

verifyLocation(): GPS+Cell+WiFi 다중 점검 및 리스크 스코어

E. 권한/정책 매트릭스(요약)

비로그인: 지도 열람(제한), 검색 일부, 상세 열람 제한

로그인: 배포/수령/전달/응답/스토어 편집/지갑 기능 가능

KYC 완료: 충전/출금/고액 배포 허용

F. 에러/토스트 메시지(대표)

위치 권한 거부: 현위치 기능을 사용하려면 설정에서 위치 권한을 허용해 주세요.

잔액 부족: 잔액이 부족합니다. 예산 화면에서 충전해 주세요.

검증 실패: 위치 검증에 실패했습니다. 네트워크 상태를 확인해 주세요.

업로드 초과: 파일 용량 제한(10MB)을 초과했습니다.

G. 성능·보안·로깅(핵심)

성능: 마커 가상화, 결과 캐시, 이미지 썸네일, 네트워크 타임아웃 10s.

보안: Firebase Rules 최소화 원칙, 서버단 권한 검증, 스푸핑/리플레이 방지.

로깅: BigQuery(또는 GA4) 이벤트 스트림, 개인정보 비식별화.

H. QA 수용 기준(샘플)

지도 클러스터: 같은 위치 30m 이내 3개 이상 → 집계 배지 표시 OK

포스트 수령: 반경 30m 밖 → 사용 불가 비활성 OK

배포 결제: 잔액=총액-1원 → 실패, 가이드 노출 OK

쿠폰 사용: GPS OFF → 사용 버튼 비활성 + 안내 OK