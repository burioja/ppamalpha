# PPAM Alpha 업데이트 - 2025년 10월 7일

## 📋 작업 현황 요약

### ✅ 완료 항목 (테스트 필요)

#### 1. 플레이스 시스템
- [x] **메인 네비게이션 아이콘 변경** - 플레이스 아이콘을 집 모양에서 가방 모양(Icons.work)으로 통일 ✅ 테스트 필요
- [x] **MyPlacesScreen OSM 지도 통합** - MapScreen과 동일한 CartoDB Voyager 타일 적용, 지도 고정, 화면 높이 40% ✅ 테스트 필요
- [x] **PlaceDetailScreen 완비** - 대문사진 캐러셀, 지도, 스토어정보, 인증여부, 운영시간, 연락처 모두 구현됨 ✅ 테스트 필요
- [x] **PlaceModel 인증 시스템** - isVerified, businessRegistrationNumber 필드 추가 ✅ 테스트 필요
- [x] **PlaceService 개발모드 자동 인증** - 플레이스 생성 시 자동으로 인증 처리 ✅ 테스트 필요

#### 2. 회원가입 시스템
- [x] **일터 등록 단일화** - 여러 일터 등록에서 1개만 등록 가능하도록 변경 ✅ 테스트 필요
- [x] **회원가입 시 플레이스 자동 생성** - 일터 정보 입력 시 자동으로 Place 생성 ✅ 테스트 필요
- [x] **UserModel 수정** - workplaceIds(배열)에서 workplaceId(단일값)로 변경 ✅ 테스트 필요

#### 3. 포스트 시스템
- [x] **PostModel 확장** - youtubeUrl 필드 추가 (홍보용 유튜브 링크) ✅ 테스트 필요
- [x] **PostService 업데이트** - createPost 메서드에 youtubeUrl 파라미터 추가 ✅ 테스트 필요
- [x] **포스트 생성 화면 최적화** - 유튜브 URL 입력 필드 추가, 기능옵션 섹션 임시 숨김, 위치 정보 섹션 제거 ✅ 테스트 필요
- [x] **포스트 수정 화면 정리** - 기본 만료일, 위치 정보 표시 제거 ✅ 테스트 필요

#### 4. 인박스 시스템
- [x] **포스트 그리드 재구성** - 그림, 제목, 단가, 날짜 표시 확인 완료 ✅ 테스트 필요
- [x] **"작성중" 배지 제거** - DRAFT 상태 포스트의 우측상단 배지 숨김 처리 ✅ 테스트 필요
- [x] **회수된 포스트 표시 추가** - RECALLED 상태에 "회수됨" 오렌지색 배지 표시 ✅ 테스트 필요
- [x] **더블탭 프로세스 구현** - PostTileCard에 애니메이션 효과 및 더블탭 핸들러 추가 ✅ 테스트 필요

### ⚠️ 남은 작업 (대규모 리팩토링 필요)

#### 5. 주은 포스트 디테일 화면 재구성
**상태**: 🔴 대규모 리팩토링 필요 (파일 크기: 2267줄)
- [ ] 화면 구성 재구성 (최상단: 사진, 리워드, 스토어 정보, 쿠폰)
- [ ] 미디어 썸네일 섹션 제거
- [ ] 중복 버튼 제거 (포스트 편집, 포스트 배포하기)
- [ ] 개발자 정보 토글 버튼 추가 (Collapse/Expand)

**권장 사항**: 별도 작업 세션에서 진행

#### 6. 통계 화면 통합 및 확장
**상태**: 🔴 대규모 리팩토링 필요 (신규 기능)
- [ ] 통계 화면 통일 (기본/수집자/시간/위치/성과/쿠폰 탭 구현)
- [ ] 통계 추가 항목
  - 한번 주은 포스트 갯수
  - 사진 확대 조회율 (주은 포스트 사진 클릭 비율)
  - 쿠폰 사용률 (별도 쿠폰 탭)

**권장 사항**: 통계 시스템 전체 재설계 필요, 별도 작업 세션에서 진행

---

## 📝 상세 구현 내용

### 완료된 작업 상세

#### 파일 변경 사항
1. **lib/features/user_dashboard/screens/main_screen.dart:223**
   - Icons.home → Icons.work 변경

2. **lib/features/place_system/screens/my_places_screen.dart**
   - OSM 타일: openstreetmap → CartoDB Voyager
   - 지도 고정: InteractiveFlag.none
   - 지도 높이: 화면의 40%

3. **lib/core/models/place/place_model.dart**
   - 추가 필드: isVerified, businessRegistrationNumber

4. **lib/core/services/data/place_service.dart**
   - 개발모드 플래그 추가
   - 자동 인증 로직 구현

5. **lib/core/models/user/user_model.dart**
   - workplaceIds → workplaceId로 변경

6. **lib/screens/auth/signup_screen.dart**
   - 일터 등록 단일화
   - 플레이스 자동 생성 로직

7. **lib/core/models/post/post_model.dart**
   - youtubeUrl 필드 추가

8. **lib/core/services/data/post_service.dart**
   - createPost에 youtubeUrl 파라미터 추가

9. **lib/features/post_system/screens/post_place_screen.dart**
   - 유튜브 URL 입력 필드 추가
   - 기능옵션 섹션 주석 처리
   - 위치 정보 섹션 제거

10. **lib/features/post_system/screens/post_edit_screen.dart**
    - 기본 만료일, 위치 필드 표시 제거

11. **lib/features/post_system/widgets/post_tile_card.dart**
    - StatelessWidget → StatefulWidget 변경
    - 더블탭 핸들러 및 애니메이션 구현
    - "작성중" 배지 제거
    - "회수됨" 배지 추가

---

## 🎯 다음 단계 권장사항

### Clear/Compact 후 진행할 작업
1. **주은 포스트 디테일 화면** (post_detail_screen.dart, 2267줄)
   - 전체 UI/UX 재설계
   - 컴포넌트 분리
   - 코드 최적화

2. **통계 화면 통합**
   - 새로운 통계 시스템 설계
   - 6개 탭 구조 구현
   - 통계 데이터 수집 로직

---

# PPAM Alpha 업데이트 - 기존 문서

## 프로젝트 개요
PPAM Alpha 앱의 주요 기능 개선 및 UI/UX 최적화 작업

---

## 1. 플레이스 관련

### 1.1. 플레이스 등록 및 인증 관련

#### 새로운 타스크
- [x] 상단 플레이스 아이콘을 맵 스크린의 가방아이콘으로 통일 ✅
- [x] 회원가입 시 일터 등록 정보로 플레이스 자동 생성 기능 구현 ✅
  - 이름과 주소를 기본값으로 사용
- [x] 플레이스 인증 시스템 구현 ✅
  - 사업자등록 인증: 인증된 플레이스
  - 미인증: 일반 플레이스
- [x] 개발모드 자동 인증 로직 구현 ✅
  - 회원가입 시 일터로 등록한 플레이스를 사업자등록 인증된 것으로 자동 처리

#### 구현 방법

**1. 아이콘 통일**
```dart
// 수정 파일: lib/screens/place/* (플레이스 관련 모든 화면)
// 수정 파일: lib/widgets/* (플레이스 아이콘 사용하는 위젯)

// 기존: Icons.store 또는 다른 아이콘
// 변경: Icons.work (가방 아이콘)

// 예시:
AppBar(
  leading: Icon(Icons.work), // 맵 스크린과 동일한 아이콘 사용
)
```

**2. 회원가입 시 플레이스 자동 생성**
```dart
// 수정 파일: lib/screens/auth/signup_screen.dart
// 수정 파일: lib/services/place_service.dart
// 수정 파일: lib/models/place_model.dart

class SignupScreen {
  Future<void> _handleWorkplaceRegistration() async {
    // 1. 일터 정보 수집 (이름, 주소)
    final workplaceName = _workplaceNameController.text;
    final workplaceAddress = _workplaceAddressController.text;

    // 2. 플레이스 자동 생성
    final newPlace = PlaceModel(
      name: workplaceName,
      address: workplaceAddress,
      isVerified: true, // 개발모드: 자동 인증
      createdAt: DateTime.now(),
      ownerId: currentUser.uid,
    );

    // 3. Firestore에 저장
    await PlaceService().createPlace(newPlace);

    // 4. 유저 정보에 플레이스 연결
    await UserService().updateUserWorkplace(
      userId: currentUser.uid,
      placeId: newPlace.id,
    );
  }
}
```

**3. PlaceModel에 인증 필드 추가**
```dart
// 수정 파일: lib/models/place_model.dart

class PlaceModel {
  final String id;
  final String name;
  final String address;
  final bool isVerified; // 사업자등록 인증 여부
  final String? businessRegistrationNumber; // 추후 확장용
  final DateTime createdAt;
  final String ownerId;

  // 개발모드에서는 isVerified = true로 자동 설정
  PlaceModel({
    required this.id,
    required this.name,
    required this.address,
    this.isVerified = true, // 개발모드 기본값
    this.businessRegistrationNumber,
    required this.createdAt,
    required this.ownerId,
  });
}
```

**4. Firestore 데이터 구조**
```
places/{placeId}
  - name: String
  - address: String
  - isVerified: Boolean (개발모드: true)
  - businessRegistrationNumber: String? (null)
  - createdAt: Timestamp
  - ownerId: String (유저 UID)
  - latitude: Double
  - longitude: Double
```

**5. 개발모드 자동 인증 로직**
```dart
// 수정 파일: lib/services/place_service.dart

class PlaceService {
  static const bool isDevelopmentMode = true; // 개발모드 플래그

  Future<PlaceModel> createPlace(PlaceModel place) async {
    // 개발모드에서는 자동으로 인증 처리
    final verifiedPlace = place.copyWith(
      isVerified: isDevelopmentMode ? true : place.isVerified,
    );

    await FirebaseFirestore.instance
        .collection('places')
        .doc(verifiedPlace.id)
        .set(verifiedPlace.toJson());

    return verifiedPlace;
  }
}
```

#### 진행 현황
- 상태: ✅ 완료 (테스트 필요)
- 비고: 사업자등록 인증 프로세스는 별도 구성하지 않음 (개발모드 자동 처리)

---

### 1.2. 플레이스 리스트

#### 새로운 타스크
- [x] OSM 지도 통합 (맵스크린과 동일) ✅
- [x] 지도 고정 및 하단 플레이스 리스트 스크롤 구현 ✅
- [ ] 전체 플레이스가 보이도록 자동 줌아웃 기능 구현
- [x] 지도 크기 조정: 화면 높이의 40% (2/5) ✅
- [x] 플레이스 리스트 항목 정보 표시 ✅
  - 대문사진
  - 제목
  - 주소
  - 인증여부

#### 진행 현황
- 상태: ✅ 대부분 완료 (테스트 필요)
- 비고: 현재 디자인 유지하되 지도 통합 완료

---

### 1.3. 플레이스 디테일

#### 새로운 타스크
- [x] 플레이스 디테일 화면 재설계 ✅
  - 인박스 > 받은포스트 > 내스토어 디자인 차용
- [x] 다음 항목 구현 ✅
  - [x] 대문사진 (좌우 스와이프 캐러셀) ✅ 테스트 완료 (CORS 설정 완료, 이미지 로딩 정상)
  - [x] 대문사진 앱바 겹침 문제 해결 ✅ 테스트 완료 (이미지가 앱바 아래부터 시작)
  - [x] 지도 높이 조정 (200px → 150px) ✅ 완료
  - [x] 캐러셀 좌우 화살표 버튼 추가 ✅ 완료
  - [x] Hero 위젯 태그 중복 에러 수정 ✅ 완료
  - [ ] 지도 (표시 확인 필요)
  - [ ] 스토어명 + 업종 (표시 확인 필요)
  - [ ] 인증여부 (표시 확인 필요)
  - [ ] 운영시간 (표시 확인 필요)
  - [ ] 연락처 (전화/이메일/웹사이트/주소) (표시 확인 필요)
- [ ] 인박스 받은포스트 화면의 "내스토어" 버튼 제거

#### 진행 현황
- 상태: 🟡 부분 완료 (추가 테스트 필요)
- 완료된 항목:
  - ✅ 이미지 캐러셀 구현 및 CORS 설정 완료
  - ✅ 이미지 앱바 겹침 문제 해결
  - ✅ 지도 높이 조정 (2cm → 1.5cm)
  - ✅ 캐러셀 화살표 버튼 추가
  - ✅ Hero 태그 중복 에러 수정
- 테스트 대기 항목:
  - ⏳ 지도 섹션 표시
  - ⏳ 스토어 정보 표시
  - ⏳ 운영시간 표시
  - ⏳ 연락처 정보 표시
- 비고: place_detail_screen.dart 이미지 관련 기능 완료, 나머지 섹션 테스트 필요

---

## 2. 회원가입 관련

### 새로운 타스크
- [x] 일터 등록 제한: 1개만 등록 가능하도록 변경 ✅

#### 진행 현황
- 상태: ✅ 완료 (테스트 필요)
- 목적: 개발모드에서 일터 등록 = 자동 사업자등록 인증 처리
- 비고: 별도 사업자등록 인증 프로세스 구성 안 함

---

## 3. 인박스 관련

### 3.1. 배포전

#### 새로운 타스크
- [x] 포스트 리스트 그리드 재구성 ✅
  - 그림
  - 제목 한줄 (말줄임표 처리)
  - 단가 (왼쪽)
  - 만든날짜 (오른쪽)
- [x] 포스트 열기 프로세스 개선 ✅
  - 1차 클릭: 테두리 표시 + 애니메이션
  - 2차 클릭: 포스트 화면 이동
- [ ] 사운드 등록 기능 복구
  - 목적: 포스트에 대한 소리 설명
- [x] 우측상단 "작성중" 표시 제거 ✅

#### 진행 현황
- 상태: ✅ 대부분 완료 (테스트 필요)
- 비고: 더블탭 애니메이션 효과 구현 완료

---

### 3.2. 배포후

#### 새로운 타스크
- [x] 회수된 포스트 표시 추가 ✅
  - 그리드에 "회수" 딱지 표시

#### 진행 현황
- 상태: ✅ 완료 (테스트 필요)

---

### 3.3. 포스트 생성

#### 새로운 타스크
- [ ] 플레이스 선택 UI/UX 개선
  - 플레이스 리스트 화면과 유사한 디자인
- [x] 기능옵션 임시 숨김 처리 ✅
- [ ] 사운드 추가 기능 복구
- [x] 유튜브 링크 추가 기능 구현 ✅
  - 목적: 홍보용 유튜브 영상 연결
- [x] 위치 정보 제거 ✅
- [ ] 모바일 한 페이지 UI/UX 최적화
  - 타이트한 디자인으로 재구성

#### 진행 현황
- 상태: ✅ 부분 완료 (테스트 필요)
- 우선순위: 높음

---

### 3.4. 포스트 수정 (배포전 포스트)

#### 새로운 타스크
- [x] 최하단 불필요 항목 제거 ✅
  - 기본 만료일
  - 위치

#### 진행 현황
- 상태: ✅ 완료 (테스트 필요)

---

### 3.5. 주은 포스트 디테일

#### 새로운 타스크
- [ ] 화면 구성 재구성 🔴 대규모 리팩토링 필요
  - 최상단: 포스트 사진 (원본)
  - 리워드 정보
  - 스토어 간략 정보 + 링크
  - 최하단: 쿠폰 사용 관련
- [ ] 미디어 썸네일 섹션 제거
- [ ] 중복 버튼 제거
  - "포스트 편집" 삭제
  - "포스트 배포하기" 삭제
- [ ] 개발자 정보 토글 버튼 추가
  - 포스트 ID 등 기본 정보
  - Collapse/Expand 기능

#### 진행 현황
- 상태: 🔴 대규모 리팩토링 필요 (파일: 2267줄)
- 비고: 별도 작업 세션 권장

---

## 4. 통계

### 새로운 타스크
- [ ] 통계 형식 통일 🔴 대규모 리팩토링 필요
  - 내 포스트 통계
  - 배포한 포스트 통계
  - 개별 포스트 통계
  - 형식: 기본/수집자/시간/위치/성과 등 상세 통계
- [ ] 포스트 통계 추가 항목
  - [ ] 한번 주은 포스트 갯수
  - [ ] 사진 확대 조회율
    - 주은 포스트의 사진 클릭 비율
  - [ ] 쿠폰 사용 여부 통계
    - 별도 쿠폰 탭 생성

#### 진행 현황
- 상태: 🔴 대규모 리팩토링 필요 (신규 기능)
- 우선순위: 중간
- 비고: 별도 작업 세션 권장

---

## 우선순위별 타스크

### 높음
1. ✅ 포스트 생성 UI/UX 최적화 (부분 완료)
2. ✅ 플레이스 자동 등록 로직 (완료)
3. ✅ 회원가입 일터 제한 (1개) (완료)

### 중간
1. ✅ 플레이스 리스트 지도 통합 (완료)
2. ✅ 포스트 열기 프로세스 개선 (완료)
3. 🔴 통계 기능 확장 (대규모 리팩토링 필요)

### 낮음
1. 🔴 주은 포스트 디테일 UI 정리 (대규모 리팩토링 필요)
2. ✅ 배포후 포스트 회수 표시 (완료)
3. 개발자 정보 토글 (주은 포스트 디테일에 포함)

---

## 다음 단계

### 즉시 테스트 필요
1. 메인 네비게이션 플레이스 아이콘
2. MyPlacesScreen OSM 지도
3. 플레이스 자동 생성 및 인증
4. 포스트 유튜브 URL 기능
5. 포스트 더블탭 애니메이션
6. 회수된 포스트 배지

### Clear/Compact 후 진행
1. 🔴 주은 포스트 디테일 화면 (2267줄, 대규모 리팩토링)
2. 🔴 통계 시스템 확장 (신규 기능, 대규모 작업)

---

## 비고

- 개발모드 특성상 사업자등록 인증 프로세스는 자동 처리
- 효과음은 공통 "뺌" 사운드 적용 (구현 확인 필요)
- UI/UX 개선 작업 대부분 완료
- 대규모 리팩토링 2건은 별도 작업 세션 권장
