# ν¬μΈνΈ μ§€κΈ‰ μ‹μ¤ν… κ°μ„ 

## π“‹ κ³Όμ  κ°μ”
**κ³Όμ  ID**: TASK-001
**μ λ©**: ν¬μΈνΈ μ§€κΈ‰ μ‹μ¤ν… κ°μ„ 
**μ°μ„ μμ„**: β­β­β­ λ†’μ
**λ‹΄λ‹Ήμ**: TBD
**μƒνƒ**: π”„ κ³„ν μ¤‘

## π― μ”κµ¬μ‚¬ν•­ λ¶„μ„

### μ‚¬μ©μ μ”κµ¬μ‚¬ν•­
1. **κΈ°μ΅΄ μ‚¬μ©μ ν¬μΈνΈ μ§€κΈ‰**: ν„μ¬ κ°€μ…μμ—κ² 10λ§ ν¬μΈνΈ μ§€κΈ‰
2. **μ‹ κ· μ‚¬μ©μ ν¬μΈνΈ μ§€κΈ‰**: μƒλ΅ κ°€μ…ν•λ” μ‚¬μ©μμ—κ² 10λ§ ν¬μΈνΈ μλ™ μ§€κΈ‰
3. **ν¬μ¤νΈ μλ Ή λ³΄μƒ**: ν¬μ¤νΈ μλ Ή μ‹ μ§€μ •ν• κ°€κ²©λ§νΌ μμ§‘μμ—κ² ν¬μΈνΈ μ§€κΈ‰

### λΉ„μ¦λ‹μ¤ μ”κµ¬μ‚¬ν•­
- ν¬μΈνΈ μ§€κΈ‰ κΈ°λ΅ μ¶”μ  κ°€λ¥
- μ¤‘λ³µ μ§€κΈ‰ λ°©μ§€
- μ‚¬μ©μ ν™λ™ μ΄‰μ§„μ„ μ„ν• μ μ ν• λ³΄μƒ μ²΄κ³„

## π” ν„μ¬ μƒνƒ λ¶„μ„

### κΈ°μ΅΄ κµ¬ν„μ‚¬ν•­
```dart
// lib/core/services/data/points_service.dart λ¶„μ„ κ²°κ³Ό

β… κµ¬ν„ μ™„λ£:
- getUserPoints(): μ‚¬μ©μ ν¬μΈνΈ μ΅°ν
- addPoints(): ν¬μΈνΈ μ¶”κ°€
- deductPoints(): ν¬μΈνΈ μ°¨κ°
- getPointsHistory(): ν¬μΈνΈ νμ¤ν† λ¦¬ μ΅°ν
- rewardPostCollection(): ν¬μ¤νΈ μμ§‘ λ³΄μƒ μ§€κΈ‰
- grantMillionPointsToAllUsers(): λ¨λ“  μ‚¬μ©μμ—κ² 100λ§ ν¬μΈνΈ μ§€κΈ‰

π”„ μμ • ν•„μ”:
- μ‹ κ· μ‚¬μ©μ κΈ°λ³Έ μ§€κΈ‰μ•΅: 100λ§ ν¬μΈνΈ β†’ 10λ§ ν¬μΈνΈ
- κΈ°μ΅΄ μ‚¬μ©μ λ³΄μ •: 100λ§ ν¬μΈνΈ μ΄μƒ λ³΄μ μ β†’ 10λ§ ν¬μΈνΈλ΅ μ΅°μ •
```

### ν„μ¬ ν¬μΈνΈ μ •μ±…
- **μ‹ κ· κ°€μ…μ**: 100λ§ ν¬μΈνΈ μλ™ μ§€κΈ‰ (line 22)
- **κΈ°μ΅΄ μ‚¬μ©μ**: `grantMillionPointsToAllUsers()` λ©”μ„λ“λ΅ 100λ§ ν¬μΈνΈ μ§€κΈ‰
- **ν¬μ¤νΈ μμ§‘**: `rewardPostCollection()` λ©”μ„λ“λ΅ λ³΄μƒ μ§€κΈ‰

## β… κµ¬ν„ κ³„ν

### Phase 1: ν¬μΈνΈ μ •μ±… μ΅°μ •
- [ ] μ‹ κ· μ‚¬μ©μ κΈ°λ³Έ μ§€κΈ‰μ•΅μ„ 10λ§ ν¬μΈνΈλ΅ λ³€κ²½
- [ ] κΈ°μ΅΄ μ‚¬μ©μ ν¬μΈνΈλ¥Ό 10λ§ ν¬μΈνΈλ΅ μ΅°μ •ν•λ” λ©”μ„λ“ κµ¬ν„
- [ ] ν¬μΈνΈ μ§€κΈ‰ νμ¤ν† λ¦¬μ— μ •μ±… λ³€κ²½ κΈ°λ΅

### Phase 2: ν¬μ¤νΈ μλ Ή λ³΄μƒ μ—°λ™ ν™•μΈ
- [ ] `collectPost` λ©”μ„λ“μ—μ„ `rewardPostCollection` νΈμ¶ ν™•μΈ
- [ ] ν¬μΈνΈ μ§€κΈ‰ μ‹¤ν¨ μ‹ λ΅¤λ°± λ©”μ»¤λ‹μ¦ ν™•μΈ
- [ ] ν¬μΈνΈ μ§€κΈ‰ λ΅κ·Έ κ°μ„ 

### Phase 3: ν…μ¤νΈ λ° κ²€μ¦
- [ ] μ‹ κ· κ°€μ…μ 10λ§ ν¬μΈνΈ μ§€κΈ‰ ν…μ¤νΈ
- [ ] κΈ°μ΅΄ μ‚¬μ©μ ν¬μΈνΈ μ΅°μ • ν…μ¤νΈ
- [ ] ν¬μ¤νΈ μμ§‘ λ³΄μƒ μ—°λ™ ν…μ¤νΈ

## π›  κµ¬ν„ μƒμ„Έ

### 1. μ‹ κ· μ‚¬μ©μ ν¬μΈνΈ μ •μ±… λ³€κ²½

```dart
// λ³€κ²½ μ „ (line 20-25)
final newUserPoints = UserPointsModel(
  userId: userId,
  totalPoints: 1000000, // 100λ§ ν¬μΈνΈ
  createdAt: DateTime.now(),
  lastUpdated: DateTime.now(),
);

// λ³€κ²½ ν›„
final newUserPoints = UserPointsModel(
  userId: userId,
  totalPoints: 100000, // 10λ§ ν¬μΈνΈ
  createdAt: DateTime.now(),
  lastUpdated: DateTime.now(),
);
```

### 2. κΈ°μ΅΄ μ‚¬μ©μ ν¬μΈνΈ μ΅°μ • λ©”μ„λ“

```dart
/// λ¨λ“  κΈ°μ΅΄ μ‚¬μ©μμ—κ² 10λ§ ν¬μΈνΈλ΅ μ΅°μ • (κ΄€λ¦¬μμ©)
Future<void> adjustToHundredThousandPoints() async {
  try {
    final querySnapshot = await _firestore
        .collection('user_points')
        .get();

    final batch = _firestore.batch();
    int updateCount = 0;

    for (final doc in querySnapshot.docs) {
      final data = doc.data();
      final currentPoints = data['totalPoints'] ?? 0;

      // 100λ§ ν¬μΈνΈ μ΄μƒ λ³΄μ μλ¥Ό 10λ§ ν¬μΈνΈλ΅ μ΅°μ •
      if (currentPoints >= 1000000) {
        batch.update(doc.reference, {
          'totalPoints': 100000,
          'lastUpdated': FieldValue.serverTimestamp(),
        });

        // νμ¤ν† λ¦¬ μ¶”κ°€
        final historyRef = doc.reference.collection('history').doc();
        batch.set(historyRef, {
          'points': 100000 - currentPoints, // μμκ°’
          'type': 'system_adjustment',
          'reason': 'ν¬μΈνΈ μ •μ±… λ³€κ²½ (10λ§ ν¬μΈνΈ μ΅°μ •)',
          'timestamp': FieldValue.serverTimestamp(),
        });

        updateCount++;
      }
    }

    if (updateCount > 0) {
      await batch.commit();
      print('β… $updateCountλ…μ μ‚¬μ©μ ν¬μΈνΈλ¥Ό 10λ§μΌλ΅ μ΅°μ • μ™„λ£');
    }

  } catch (e) {
    print('β ν¬μΈνΈ μ΅°μ • μ‹¤ν¨: $e');
    rethrow;
  }
}
```

### 3. ν¬μ¤νΈ μμ§‘ λ³΄μƒ μ—°λ™ μ κ²€

ν„μ¬ `PostService.collectPost()` λ©”μ„λ“μ—μ„ ν¬μΈνΈ μ§€κΈ‰ μ—°λ™ μƒνƒλ¥Ό ν™•μΈν•΄μ•Ό ν•¨:

```dart
// ν™•μΈ ν•„μ” μ‚¬ν•­
1. collectPost() λ©”μ„λ“μ—μ„ rewardPostCollection() νΈμ¶ μ—¬λ¶€
2. ν¬μΈνΈ μ§€κΈ‰ μ‹¤ν¨ μ‹ μμ§‘ μ‘μ—… λ΅¤λ°± μ—¬λ¶€
3. ν¬μΈνΈ μ§€κΈ‰ λ΅κ·Έ μ¶©λ¶„μ„±
```

## π“ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### μ‹λ‚λ¦¬μ¤ 1: μ‹ κ· κ°€μ…μ ν¬μΈνΈ μ§€κΈ‰
1. μƒ μ‚¬μ©μ κ³„μ • μƒμ„±
2. `getUserPoints()` νΈμ¶
3. 10λ§ ν¬μΈνΈ μλ™ μ§€κΈ‰ ν™•μΈ
4. ν¬μΈνΈ νμ¤ν† λ¦¬ κΈ°λ΅ ν™•μΈ

### μ‹λ‚λ¦¬μ¤ 2: κΈ°μ΅΄ μ‚¬μ©μ ν¬μΈνΈ μ΅°μ •
1. 100λ§ ν¬μΈνΈ μ΄μƒ λ³΄μ  μ‚¬μ©μ μ„ νƒ
2. `adjustToHundredThousandPoints()` μ‹¤ν–‰
3. ν¬μΈνΈκ°€ 10λ§μΌλ΅ μ΅°μ •λμ—λ”μ§€ ν™•μΈ
4. μ΅°μ • νμ¤ν† λ¦¬ κΈ°λ΅ ν™•μΈ

### μ‹λ‚λ¦¬μ¤ 3: ν¬μ¤νΈ μμ§‘ λ³΄μƒ
1. ν¬μ¤νΈ μμ§‘ μ‹¤ν–‰
2. μμ§‘ μ™„λ£ ν›„ ν¬μΈνΈ μ§€κΈ‰ ν™•μΈ
3. μ§€κΈ‰λ ν¬μΈνΈκ°€ μ„¤μ •λ λ¦¬μ›λ“μ™€ μΌμΉν•λ”μ§€ ν™•μΈ
4. ν¬μΈνΈ νμ¤ν† λ¦¬μ— κΈ°λ΅λμ—λ”μ§€ ν™•μΈ

## π“ μ²΄ν¬λ¦¬μ¤νΈ

### κ°λ° λ‹¨κ³„
- [ ] μ‹ κ· μ‚¬μ©μ ν¬μΈνΈ μ •μ±… λ³€κ²½ (100λ§ β†’ 10λ§)
- [ ] κΈ°μ΅΄ μ‚¬μ©μ ν¬μΈνΈ μ΅°μ • λ©”μ„λ“ κµ¬ν„
- [ ] ν¬μΈνΈ μ§€κΈ‰ νμ¤ν† λ¦¬ λ΅μ§ κ°μ„ 
- [ ] ν¬μ¤νΈ μμ§‘ λ³΄μƒ μ—°λ™ ν™•μΈ

### ν…μ¤νΈ λ‹¨κ³„
- [ ] λ‹¨μ„ ν…μ¤νΈ μ‘μ„±
- [ ] ν†µν•© ν…μ¤νΈ μν–‰
- [ ] μ‚¬μ©μ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

### λ°°ν¬ λ‹¨κ³„
- [ ] μ½”λ“ λ¦¬λ·° μ™„λ£
- [ ] QA κ²€μ¦ μ™„λ£
- [ ] ν”„λ΅λ•μ… λ°°ν¬

## π¨ μ„ν— μ”μ† λ° λ€μ‘ λ°©μ•

### μ„ν— μ”μ†
1. **λ€λ‰ ν¬μΈνΈ μ΅°μ • μ‹ μ„±λ¥ μ΄μ**: μ‚¬μ©μκ°€ λ§μ„ κ²½μ° λ°°μΉ μ²λ¦¬ μ‹κ°„ μ¦κ°€
2. **ν¬μΈνΈ μ¤‘λ³µ μ§€κΈ‰**: μ‹μ¤ν… μ¤λ¥λ΅ μΈν• μ¤‘λ³µ μ§€κΈ‰ κ°€λ¥μ„±
3. **λ°μ΄ν„° μΌκ΄€μ„±**: ν¬μΈνΈ μ΅°μ • μ¤‘ μ‹μ¤ν… μ¥μ•  λ°μƒ μ‹ λ°μ΄ν„° λ¶μΌμΉ

### λ€μ‘ λ°©μ•
1. **λ°°μΉ μ²λ¦¬ μµμ ν™”**: μ²­ν¬ λ‹¨μ„λ΅ λ‚λ„μ–΄ μ²λ¦¬
2. **μ¤‘λ³µ λ°©μ§€ λ΅μ§**: μ΅°μ • μ΄λ ¥ ν™•μΈ ν›„ μ²λ¦¬
3. **νΈλμ­μ… μ²λ¦¬**: Firestore λ°°μΉ νΈλμ­μ… ν™μ©

## π“… μΌμ • κ³„ν

| λ‹¨κ³„ | μ‘μ—… λ‚΄μ© | μμƒ μ†μ” μ‹κ°„ | λ§κ°μΌ |
|------|-----------|---------------|--------|
| λ¶„μ„ | ν„μ¬ μƒνƒ λ¶„μ„ μ™„λ£ | 0.5μΌ | β… μ™„λ£ |
| κ°λ° | ν¬μΈνΈ μ •μ±… λ³€κ²½ κµ¬ν„ | 1μΌ | TBD |
| ν…μ¤νΈ | λ‹¨μ„/ν†µν•© ν…μ¤νΈ | 0.5μΌ | TBD |
| λ°°ν¬ | ν”„λ΅λ•μ… μ μ© | 0.5μΌ | TBD |

**μ΄ μμƒ κΈ°κ°„**: 2.5μΌ

---

*μ‘μ„±μΌ: 2025-09-30*
*μµμΆ… μμ •μΌ: 2025-09-30*